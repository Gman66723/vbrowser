{"version":3,"sources":["icon-lib.js","lib/ServerController.js","lib/SocketController.js","components/VideoStream.js","lib/InstructionBuffer.js","lib/BrowserController.js","pages/Room/WaitingElement.js","pages/Room/index.js","components/layouts/FullScreen.js","ResetCSS.js","theme.js","components/Navbar.js","App.js","serviceWorker.js","index.js"],"names":["library","add","faExpand","faVolumeMute","faVolumeUp","faMicrophone","faMicrophoneSlash","faVideo","faVideoSlash","faPaperPlane","faComment","faCommentSlash","faMousePointer","faStopCircle","Icon","baseUrl","endpoint","initOpts","credentials","headers","fetch","this","result","data","json","ok","Error","EVENT_TYPES","REQUEST","READY","PROVIDE","RESPONSE","WRTCSessionManager","options","server","id","clientType","signalServer","connection","peers","Map","init","event","JSON","stringify","type","sender","msg","initiator","peer","SimplePeer","cid","set","on","send","createPacket","err","console","error","emit","log","delete","chunk","parse","signal","target","stream","has","createPeer","get","message","rest","setIdentity","attachIdentity","processSignal","ServerController","ping","WebSocket","Array","forEach","eventType","addEventListener","bind","EventEmitter","Container","styled","div","focused","props","source","children","vbController","fullscreen","aspectRatio","ref","useRef","controllerRef","useState","setFocused","useEffect","video","current","srcObject","src","window","URL","createObjectURL","blur","focus","lsnr","removeEventListener","getMousePosition","e","rect","getBoundingClientRect","scaleX","width","scaleY","height","x","Math","round","clientX","left","y","clientY","top","onMouseDown","btn","preventDefault","mouseDown","className","ratio","style","maxWidth","margin","position","autoPlay","tabIndex","hidden","onMouseEnter","onMouseLeave","onWheel","ydir","sign","deltaY","xdir","deltaX","onMouseWheel","onKeyDown","key","keyDown","onKeyUp","keyUp","onContextMenu","onMouseUp","mouseUp","onMouseMove","mouseMove","opCodes","MOUSE_MOVE","MOUSE_BTN_DWN","MOUSE_BTN_UP","MOUSE_BTN_CLK","KEY_DOWN","KEY_UP","REQUEST_CONTROL","RELEASE_CONTROL","ERROR","list","Set","URLS","VirtualBrowserController","client","vbClient","args","status","WaitingElement","onRequestBrowser","onClick","ElementsContainer","RoomContainer","location","hostname","streamSource","setStreamSource","setVBController","manager","a","destroy","createInstance","browserId","VideoStream","prefixes","document","fullscreenEnabled","some","prefix","icon","scrollX","scrollY","scroll","ResetCSS","styles","css","dark","name","background","primary","secondary","darken","x1","text","light","NavbarContainer","theme","Navbar","AppContainer","RouteContainer","App","FullScreen","path","exact","component","RoomPage","Boolean","match","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister"],"mappings":"+NAiBAA,IAAQC,IACNC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,IACAC,KAGaC,QAAf,E,0HCTe,MAvBO,iDACpBC,QAAU,oBADU,yMAGRC,GAHQ,kFAIZC,EAAW,CACfC,YAAc,UACdC,QAAU,CACR,eAAgB,qBAPF,SAUGC,MAAMC,KAAKN,QAAUC,EAAUC,GAVlC,UAUZK,EAVY,OAWZC,EAAOD,EAAOE,OAChBF,EAAOG,GAZO,sBAaV,IAAIC,MAAMH,GAbA,gCAeXA,GAfW,qIAmBlB,OAAOF,KAAKD,MAAM,SAnBA,M,yjBCItB,IAAMO,EACK,CACPC,QAAU,iBACVC,MAAQ,gBAHNF,EAKO,CACTG,QAAU,mBACVF,QAAU,mBACVG,SAAW,qBAIMC,E,YACnB,aAA0B,IAAD,EAAbC,EAAa,uDAAH,GAAG,oBACvB,8CADuB,IAGrBC,EACED,EADFC,OAHqB,OAKvB,EAAKC,GAAK,KACV,EAAKC,WAAa,SAClB,EAAKC,aAAeH,EACpB,EAAKI,WAAa,KAClB,EAAKC,MAAQ,IAAIC,IACjB,EAAKC,OAVkB,E,0EAaZC,GAAgB,IAATnB,EAAQ,uDAAH,GACvB,OAAOoB,KAAKC,UAAL,GACLC,KAAOH,EACPI,OAASzB,KAAKc,IACXZ,M,iCASIwB,GAAsB,IAAD,OAAhBC,IAAgB,yDACxBC,EAAO,IAAIC,IAAW,CAAEF,cAqC9B,OApCAC,EAAKE,IAAMJ,EAAII,IACf9B,KAAKkB,MAAMa,IAAIH,EAAKE,IAAKF,GACzBA,EAAKI,GAAG,WAAW,WACjBJ,EAAKK,KAAK,EAAKC,aAAa5B,EAAqBC,aAGnDqB,EAAKI,GAAG,SAAS,SAAAG,GACfC,QAAQC,MAAMF,GACd,EAAKG,KAAK,aAAcH,MAE1BP,EAAKI,GAAG,SAAS,WACfI,QAAQG,IAAI,oBAAqBX,EAAKE,KACtC,EAAKQ,KAAK,kBAAmBV,EAAKE,KAClC,EAAKZ,MAAMsB,OAAOZ,EAAKE,QAEzBF,EAAKI,GAAG,QAAQ,SAACS,GAAS,IAAD,EACCnB,KAAKoB,MAAMD,GAA5BjB,EADgB,EAChBA,KAAStB,EADO,wBAEvBkC,QAAQG,IAAIf,EAAMtB,GACd,EAAKsB,IAET,EAAKA,GAAMtB,EAAM0B,MAEnBA,EAAKI,GAAG,UAAU,SAAAW,GAChB,EAAK1B,WAAWgB,KAAKX,KAAKC,UAAU,CAClCC,KAAM,SACNoB,OAAQhB,EAAKE,IACba,eAGJf,EAAKI,GAAG,UAAU,SAAAa,GAIhBT,QAAQG,IAAIM,EAAQjB,GACpB,EAAKU,KAAK,iBAAkBO,EAAQjB,MAE/B5B,O,kCAGGE,GAAM,IACRY,EAAOZ,EAAPY,GACRd,KAAKc,GAAKA,I,qCAGGZ,GACbkC,QAAQG,IAAI,kBAAmBrC,K,oCAGnBA,GACRF,KAAKkB,MAAM4B,IAAI5C,EAAK4B,MACtB9B,KAAK+C,WAAW7C,GAAM,GAExBF,KAAKkB,MAAM8B,IAAI9C,EAAK4B,KAAKa,OAAOzC,EAAKyC,U,+BAG9BM,GACP,IAAM/C,EAAOoB,KAAKoB,MAAMO,EAAQ/C,MAExBsB,EAAkBtB,EAAlBsB,KAAS0B,EAHO,YAGEhD,EAHF,UAIxB,OAAQsB,GACN,KAAKlB,EAAqBG,QACxBT,KAAKmD,YAAYD,GACjB,MACF,KAAK5C,EAAqBI,SACxBV,KAAKoD,eAAeF,GACpB,MACF,IAAK,WACHlD,KAAK+C,WAAWG,GAAM,GACtB,MACF,IAAK,SACHlD,KAAKqD,cAAcH,M,KAQxB5C,EAAmBE,M,eAAON,EAAM0B,GAC/BA,EAAKK,KAAKjC,KAAKkC,aAAa5B,EAAmBC,Y,kKAIzC+C,EAAiBC,O,OAEvBvD,KAAKiB,WAAa,IAAIuC,UAAUxD,KAAKgB,cAErC,IAAIyC,MAAM,OAAQ,UAAW,SAASC,SAAQ,SAAAC,GACxC,EAAK,IAAD,OAAKA,KACb,EAAK1C,WAAW2C,iBAAiBD,EAAW,EAAK,IAAD,OAAKA,IAAaE,KAAK,O,sIAKzE,OAAO7D,S,GA3HqC8D,K,wlBCXhD,IAAMC,EAAYC,IAAOC,IAAV,KAyBT,YACA,OADa,EAAXC,QAEI,gEADc,MAQX,WAASC,GAAO,IAE3BC,EAKED,EALFC,OACAC,EAIEF,EAJFE,SACAC,EAGEH,EAHFG,aAJ0B,EAOxBH,EAFFI,kBAL0B,WAOxBJ,EADFK,mBAN0B,MAMZ,OANY,EAStBC,EAAMC,mBACNC,EAAgBD,mBAVM,EAWEE,qBAXF,mBAWrBV,EAXqB,KAWZW,EAXY,KAa5BC,qBAAU,WACR,IAAMC,EAAQN,EAAIO,QACd,cAAeD,EACjBA,EAAME,UAAYb,EAElBW,EAAMG,IAAMC,OAAOC,IAAIC,gBAAgBjB,KAExC,CAACA,EAAQK,IAEZK,qBAAU,WAER,IAAIZ,EACF,OAAOS,EAAcK,SAAWL,EAAcK,QAAQM,OACxDX,EAAcK,SAAWL,EAAcK,QAAQO,QAC/C,IAAMC,EAAO,WAAM,OAAO,GAE1B,OADAL,OAAOvB,iBAAiB,QAAS4B,GAC1B,kBAAML,OAAOM,oBAAoB,QAAQD,MAC/C,CAACtB,IAEJ,IAAMwB,EAAmB,SAACC,GACxB,IACMC,EADQnB,EAAIO,QACCa,wBAIbC,EAFY,KAESF,EAAKG,MAC1BC,EAFY,IAESJ,EAAKK,OAC1BC,EAAIC,KAAKC,MAAMN,GAAUH,EAAEU,QAAUT,EAAKU,OAC1CC,EAAIJ,KAAKC,MAAMJ,GAAUL,EAAEa,QAAUZ,EAAKa,MAEhD,OADArE,QAAQG,IAAI2D,EAAGK,GACR,CAACL,EAAGK,IAOPG,EAAc,SAACf,GAAc,IAAXgB,EAAU,uDAAN,EAC1B,QAAIrC,KACDqC,EAAM,GAAKA,EAAM,IAClBhB,EAAEiB,iBAEJtC,EAAauC,UAAb,MAAAvC,EAAY,YAAcoB,EAAiBC,IAA/B,QAAmCgB,MACxC,IA2CT,OACE,kBAAC5C,EAAD,CAAW+C,UAAW,YAAa5C,QAASA,EAASK,WAAYA,GAC/D,kBAAC,IAAD,CAAawC,MAAOvC,EAAawC,MAAO,CAAEC,SAAU,SAAUC,OAAS,OAAQC,SAAS,aACtF,oCACA,2BAAO1C,IAAKA,EAAK2C,UAAQ,IACzB,yBACEC,SAAS,IACTC,QAASlD,EACT0C,UAAW,eACXrC,IAAKE,EACL4C,aAAc,kBAAI1C,GAAW,IAC7B2C,aAAc,kBAAI3C,GAAW,IAC7B4C,QAAS,SAAC9B,GAAD,OAtCI,SAACA,GACpB,IAAIgB,EACEe,EAAOvB,KAAKwB,KAAKhC,EAAEiC,QACnBC,EAAO1B,KAAKwB,KAAKhC,EAAEmC,QACzB,GAAID,GAASH,EAKb,OAJGA,EAAO,IAAGf,EAAM,GAChBe,EAAO,IAAGf,EAAM,GAChBkB,EAAO,IAAGlB,EAAM,GAChBkB,EAAO,IAAGlB,EAAM,GACZD,EAAYf,EAAGgB,GA6BFoB,CAAapC,IAC3BqC,UAxBU,SAACrC,GACjBvD,QAAQG,IAAIoD,EAAEsC,KACd3D,EAAa4D,QAAQvC,EAAEsC,KACvBtC,EAAEiB,kBAsBIuB,QAnBQ,SAACxC,GACfrB,EAAa8D,MAAMzC,EAAEsC,KACrBtC,EAAEiB,kBAkBIyB,cAAe,SAAC1C,GAAD,OAAKe,EAAYf,EAAG,IACnCe,YAAa,SAACf,GAAD,OAAOe,EAAYf,EAAG,IACnC2C,UAAW,SAAC3C,GAAD,OAzDD,SAACA,GAAc,IAAXgB,EAAU,uDAAN,EAEpBrC,GACJA,EAAaiE,QAAb,MAAAjE,EAAY,YAAYoB,EAAiBC,IAA7B,QAAiCgB,KAsDrB2B,CAAU3C,EAAG,IAC/B6C,YApDY,SAAC7C,GAEfrB,GAGJA,EAAamE,UAAb,MAAAnE,EAAY,YAAcoB,EAAiBC,WAmDtCvB,GAAU,yBAAK0C,UAAW,qBAAsBzC,KChK5CqE,EAAU,CACrBC,WAAY,EACZC,cAAe,EACfC,aAAc,EAEdC,cAAe,EACfC,SAAU,EACVC,OAAQ,EACRC,gBAAiB,EACjBC,gBAAiB,EACjBC,MAAO,KAGHC,EAAO,IAAIC,IACjB,IAAI,IAAMpB,KAAOS,EACfU,EAAKxK,IAAI8J,EAAQT,IAEnBS,EAAQU,KAAOA,E,ICfTE,EAEG,oBAFHA,EAGO,yBAKQC,E,WACnB,WAAYC,GAAQ,oBAClBxJ,KAAKyJ,SAAWD,E,oDAYVtD,EAAGK,EAAGI,GACZ3G,KAAKyJ,SAASxH,KAAKX,KAAKC,UAAU,CAChCC,KAAO,UACPkI,KAAO,CAACxD,EAAGK,EAAGI,Q,gCAURT,EAAGK,EAAGI,GACdvE,QAAQG,IAAI,YAAa2D,EAAGK,EAAGI,GAC/B3G,KAAKyJ,SAASxH,KAAKX,KAAKC,UAAU,CAChCC,KAAO,YACPkI,KAAO,CAACxD,EAAGK,EAAGI,Q,gCAGRT,EAAGK,GAKXvG,KAAKyJ,SAASxH,KAAKX,KAAKC,UAAU,CAChCC,KAAO,YACPkI,KAAO,CAACxD,EAAGK,Q,8BAGP0B,GAINjI,KAAKyJ,SAASxH,KAAKX,KAAKC,UAAU,CAChCC,KAAM,UACNkI,KAAO,CAACzB,Q,4BAINA,GAIJjI,KAAKyJ,SAASxH,KAAKX,KAAKC,UAAU,CAChCC,KAAM,QACNkI,KAAO,CAACzB,S,wKAnDWlI,MAAMuJ,EAAUA,G,cAA/BrJ,E,OACNmC,QAAQG,IAAItC,EAAO0J,Q,kBACZ1J,EAAO0J,OAAS,KAAO1J,EAAO0J,OAAS,K,6lBClBlD,IAAM5F,EAAYC,IAAOC,IAAV,KAuBA,SAAS2F,EAAezF,GAAO,IAE1C0F,EACE1F,EADF0F,iBAEF,OACE,kBAAC,EAAD,KACE,iCACE,wDAEE,2BAAOrI,KAAM,UAEf,6BACE,4BAAQsI,QAASD,GAAjB,uB,sdC7BV,IAAME,GAAoB/F,IAAOC,IAAV,KAgBjB+F,GAAgBhG,IAAOC,IAAV,KAOJ,YAASE,GAAO,IAAD,EAIxBA,EADFtD,cAH0B,sBAGRsE,OAAO8E,SAASC,UAHR,IAMYtF,qBANZ,mBAMrBuF,EANqB,KAMPC,EANO,OAOYxF,qBAPZ,mBAOrBN,EAPqB,KAOP+F,EAPO,KAQtB5F,EAAMC,mBAEZI,qBAAU,WACR,IAAMwF,EAAU,IAAI3J,EAAmB,CAACE,WAexC,OAdAyJ,EAAQtI,GAAG,OAAX,sBAAmB,sBAAAuI,EAAA,2FAGnBD,EAAQtI,GAAG,gBAAgB,SAAC9B,GAC1BkC,QAAQG,IAAR,0BAA+BrC,OAGjCoK,EAAQtI,GAAG,kBAAkB,SAACa,EAAQjB,GACpCQ,QAAQG,IAAI,kBAAmBM,GAC/BuH,EAAgBvH,GAEhBwH,EAAgB,IAAId,EAAyB3H,OAGxC,kBAAM0I,EAAQE,aACpB,CAAC3J,IAEJ,IAkBMgJ,EAAgB,uCAAG,4BAAAU,EAAA,6DACvBnI,QAAQG,IAAI,oBADW,SAECgH,EAAyBkB,iBAF1B,OAEjBC,EAFiB,OAGvBtI,QAAQG,IAAImI,GAHW,2CAAH,qDAMtB,OACE,kBAACV,GAAD,CAAevF,IAAKA,GAClB,kBAACkG,EAAD,CAAavG,OAAQ+F,EAAc7F,aAAcA,GAC/C,kBAACsF,EAAD,CAAgBC,iBAAkBA,KAEpC,kBAACE,GAAD,KACE,4BAAQD,QA9BW,WAEvB,IAAMc,EAAW,IAAInH,MAAM,MAAO,KAAM,UACxC,SAAIoH,SAASC,oBAAsBF,EAASG,MAAK,SAAAC,GAAM,OAAEH,SAAS,GAAD,OAAIG,EAAJ,2BAG1DJ,EAASG,MAAK,SAAAC,GACnB,MAAqD,qBAA3CH,SAAS,GAAD,OAAIG,EAAJ,wBACdH,SAAS,GAAD,OAAIG,EAAJ,sBAGVH,SAAS,GAAD,OAAIG,EAAJ,qBAFRvG,EAAIO,QAAJ,UAAegG,EAAf,yBAIK,QAkBH,kBAAC,EAAD,CAAMC,KAAK,e,0KC1FNjH,WAAOC,IAAtB,MAGiB,YAAc,IAAZiH,EAAW,EAAXA,QACf,OAAIA,GACW,IAAZA,EAAyB,SACrBA,EAFa,YAIP,YAAc,IAAZC,EAAW,EAAXA,QACf,OAAIA,GACW,IAAZA,EAAyB,SACrBA,EAFa,YAIT,YAAa,IAAXC,EAAU,EAAVA,OACb,OAAIA,GACU,IAAXA,EAAwB,SACpBA,EAFY,Y,qkDCbR,SAASC,KACtB,OACE,kBAAC,KAAD,CAAQC,OAAQC,aAAF,QCLH,QACbC,KAAO,CACLC,KAAO,OACPC,WAAa,CACXC,QAAU,UACVC,UAAY,WAEdC,OAAS,CACPC,GAAK,mBAEPC,KAAO,CACLJ,QAAU,QACVC,UAAY,UAGhBI,MAAQ,CACNP,KAAO,U,gLCbX,IAAMQ,GAAkBjI,IAAOC,IAAV,MAGJ,qBAAEiI,MAAiBL,OAAOC,MAK5B,SAASK,KACtB,OACE,kBAACF,GAAD,KACE,kCACA,+B,obCHN,IAAMG,GAAepI,IAAOC,IAAV,MAKD,qBAAEiI,MAAeR,WAAWC,WAGvCU,GAAiBrI,IAAOC,IAAV,MAKdgI,GAAkBjI,IAAOC,IAAV,MAIJ,qBAAEiI,MAAeR,WAAWE,aAyB9BU,OArBf,WAEE,OACE,kBAAC,IAAD,CAAeJ,MAAOA,GAAMV,MAC1B,kBAACe,GAAD,KACE,kBAAClB,GAAD,MACA,kBAAC,IAAD,KACE,kBAACe,GAAD,KACE,kBAAC,GAAD,KACE,kBAACD,GAAD,OAEF,kBAACE,GAAD,KACE,kBAAC,IAAD,CAAOG,KAAK,IAAIC,OAAK,EAACC,UAAWC,WCjC3BC,QACW,cAA7BzH,OAAO8E,SAASC,UAEe,UAA7B/E,OAAO8E,SAASC,UAEhB/E,OAAO8E,SAASC,SAAS2C,MACvB,2DCZNC,IAASC,OAAO,kBAAC,GAAD,MAASlC,SAASmC,eAAe,SD2H3C,kBAAmBC,WACrBA,UAAUC,cAAcC,MAAMC,MAAK,SAAAC,GACjCA,EAAaC,iB","file":"static/js/main.d1cec1ba.chunk.js","sourcesContent":["import { FontAwesomeIcon as Icon } from '@fortawesome/react-fontawesome'\nimport { library } from '@fortawesome/fontawesome-svg-core'\nimport { \n  faExpand, \n  faVolumeMute, \n  faVolumeUp,\n  faMicrophone,\n  faMicrophoneSlash,\n  faVideo,\n  faVideoSlash,\n  faPaperPlane,\n  faComment,\n  faCommentSlash,\n  faMousePointer,\n  faStopCircle\n} from '@fortawesome/free-solid-svg-icons'\n\nlibrary.add(\n  faExpand, \n  faVolumeMute, \n  faVolumeUp, \n  faMicrophone, \n  faMicrophoneSlash,\n  faVideo,\n  faVideoSlash,\n  faPaperPlane,\n  faComment,\n  faCommentSlash,\n  faMousePointer,\n  faStopCircle\n)\n\nexport default Icon","const ServerController = class {\n  baseUrl = 'https://localhost'\n\n  async fetch(endpoint){\n    const initOpts = {\n      credentials : 'include',\n      headers : {\n        'Content-Type': 'application/json',\n      }\n    }\n    const result = await fetch(this.baseUrl + endpoint, initOpts)\n    const data = result.json()\n    if(!result.ok){\n      throw new Error(data)\n    }\n    return data\n  }\n\n  ping(){\n    return this.fetch('/')\n  }\n}\n\nexport default new ServerController()","import SimplePeer from 'simple-peer'\nimport EventEmitter from 'eventemitter3'\nimport ServerController from './ServerController'\n\nconst EVENT_TYPES = {\n  STREAM : {\n    REQUEST : 'stream/request',\n    READY : 'stream/ready'\n  },\n  IDENTITY : {\n    PROVIDE : 'identity/provide',\n    REQUEST : 'identity/request',\n    RESPONSE : 'identity/response'\n  }\n}\n\nexport default class WRTCSessionManager extends EventEmitter {\n  constructor(options = {}){\n    super()\n    const { \n      server\n    } = options\n    this.id = null // set by signal server\n    this.clientType = 'client'\n    this.signalServer = server\n    this.connection = null\n    this.peers = new Map()\n    this.init()\n  }\n\n  createPacket(event, data={}){\n    return JSON.stringify({\n      type : event,\n      sender : this.id,\n      ...data\n    })\n  }\n\n  /**\n   * This could use a lot of refactoring\n   * @param {*} msg \n   * @param {*} initiator \n   */\n  createPeer(msg, initiator=true) {\n    const peer = new SimplePeer({ initiator })\n    peer.cid = msg.cid\n    this.peers.set(peer.cid, peer)\n    peer.on('connect', () => {\n      peer.send(this.createPacket(EVENT_TYPES.IDENTITY.REQUEST))\n      // this.emit('peer.connect', peer.cid)\n    })\n    peer.on('error', err => {\n      console.error(err)\n      this.emit('peer.error', err)\n    })\n    peer.on('close', () => {\n      console.log('Peer Disconnected', peer.cid)\n      this.emit('peer.disconnect', peer.cid)\n      this.peers.delete(peer.cid)\n    })\n    peer.on('data', (chunk)=>{\n      const {type, ...data} = JSON.parse(chunk)\n      console.log(type, data)\n      if(!this[type])\n        return \n      this[type](data, peer)\n    })\n    peer.on('signal', signal => {\n      this.connection.send(JSON.stringify({\n        type: 'signal',\n        target: peer.cid,\n        signal\n      }))\n    })\n    peer.on('stream', stream => {\n\n      // check the peer type to determine which event \n      // to use\n      console.log(stream, peer)\n      this.emit('browser.stream', stream, peer)\n    })\n    return this;\n  }\n\n  setIdentity(data){\n    const { id } = data\n    this.id = id\n  }\n\n  attachIdentity(data){\n    console.log('Attach Identity', data)\n  }\n\n  processSignal(data) {\n    if(!this.peers.has(data.cid)) {\n      this.createPeer(data, false)\n    }\n    this.peers.get(data.cid).signal(data.signal)\n  }\n\n  _message(message, ...args){\n    const data = JSON.parse(message.data)\n    // console.log(data, ...args)\n    const { type, ...rest } = data\n    switch (type) {\n      case EVENT_TYPES.IDENTITY.PROVIDE:\n        this.setIdentity(rest)\n        break\n      case EVENT_TYPES.IDENTITY.RESPONSE:\n        this.attachIdentity(rest)\n        break\n      case 'announce':\n        this.createPeer(rest, true)\n        break\n      case 'signal':\n        this.processSignal(rest)\n        break\n      default:\n        break\n        // this.emit(type, rest)\n    }\n  }\n\n  [EVENT_TYPES.STREAM.READY](data, peer){\n    peer.send(this.createPacket(EVENT_TYPES.STREAM.REQUEST))\n  }\n\n  async init(){\n    await ServerController.ping()\n    // console.log(this.signalServer)\n    this.connection = new WebSocket(this.signalServer)\n    // eslint-disable-next-line\n    new Array('open', 'message', 'error').forEach(eventType => {\n      if(!this[`_${eventType}`]) return\n      this.connection.addEventListener(eventType, this[`_${eventType}`].bind(this))\n    })\n  }\n\n  destroy(){\n    return this\n  }\n}","import React, { useRef, useState, useEffect } from 'react'\nimport AspectRatio from 'react-aspect-ratio'\nimport styled from '@emotion/styled'\n\n\nconst Container = styled.div`\n  flex : 1;\n  position : relative;\n  padding : 20px 20px 0 20px;\n  & video {\n    width : 100%;\n    // background : black;\n  }\n  .waiting-component {\n    position : absolute;\n    top : 0;\n    bottom : 0;\n    left : 0;\n    right : 0;\n  }\n  & .click-shield {\n    position : absolute;\n    outline : none;\n    top : 0;\n    left : 0;\n    right : 0;\n    bottom : 3px;\n    box-sizing : content-box;\n    transition : 500ms all ease-in-out;\n    box-shadow: 0 0 0 transparent;\n    ${({focused})=>{\n      if(!focused) return ''\n      return `\n        box-shadow: 0 0 30px rgba(255,255,255,0.2);\n      `\n    }}\n  }\n`\n\nexport default function(props){\n  const { \n    source,\n    children,\n    vbController,\n    fullscreen = false,\n    aspectRatio = \"16/9\"\n  } = props\n\n  const ref = useRef()\n  const controllerRef = useRef()\n  const [focused, setFocused] = useState()\n\n  useEffect(()=>{\n    const video = ref.current\n    if ('srcObject' in video) {\n      video.srcObject = source\n    } else {\n      video.src = window.URL.createObjectURL(source) // for older browsers\n    }\n  }, [source, ref])\n\n  useEffect(()=>{\n    // prevent wheel scrolling from scrolling document\n    if(!focused)\n      return controllerRef.current && controllerRef.current.blur()\n    controllerRef.current && controllerRef.current.focus()\n    const lsnr = ()=>{ return false }\n    window.addEventListener('wheel', lsnr)\n    return () => window.removeEventListener('wheel',lsnr)\n  }, [focused])\n\n  const getMousePosition = (e) => {\n    const video = ref.current \n    const rect = video.getBoundingClientRect()\n    // todo: get the original width / height of the video from server?\n    const originalW = 1280\n    const originalH = 720\n    const scaleX = originalW / rect.width\n    const scaleY = originalH / rect.height\n    const x = Math.round(scaleX * (e.clientX - rect.left))\n    const y = Math.round(scaleY * (e.clientY - rect.top))\n    console.log(x, y)\n    return [x, y]\n  }\n  /**\n   * \n   * @param {React.MouseEvent} e \n   * @param {*} btn \n   */\n  const onMouseDown = (e, btn=0) => {\n    if(!vbController) return false\n    if(btn < 4 || btn > 7)\n      e.preventDefault()\n    // e.preventDefault()\n    vbController.mouseDown(...getMousePosition(e), btn)\n    return false\n  }\n\n  const onMouseUp = (e, btn=0) => {\n    // e.preventDefault()\n    if(!vbController) return\n    vbController.mouseUp(...getMousePosition(e), btn)\n  }\n  // TODO: throttle number of mousemoves \n  const onMouseMove = (e) => {\n    // e.preventDefault()\n    if(!vbController) return \n    // TODO: Does current user control video\n    // if(!vidFocus) return false;\n    vbController.mouseMove(...getMousePosition(e))\n  }\n\n  const onMouseWheel = (e) => {\n    let btn\n    const ydir = Math.sign(e.deltaY);\n    const xdir = Math.sign(e.deltaX)\n    if(!xdir && !ydir) return\n    if(ydir < 0) btn = 4\n    if(ydir > 0) btn = 5\n    if(xdir < 0) btn = 6\n    if(xdir > 0) btn = 7\n    return onMouseDown(e, btn)\n  }\n  /**\n   * \n   * @param {React.KeyboardEvent} e \n   */\n  const onKeyDown = (e) => {\n    console.log(e.key)\n    vbController.keyDown(e.key)\n    e.preventDefault()\n  }\n\n  const onKeyUp = (e) => {\n    vbController.keyUp(e.key)\n    e.preventDefault()\n  }\n  // idea: when vidContainerInner size changes, dynamically change video size too\n  return (\n    <Container className={'container'} focused={focused} fullscreen={fullscreen}>\n      <AspectRatio ratio={aspectRatio} style={{ maxWidth: '1280px', margin : 'auto', position:'relative' }}>\n        <>\n        <video ref={ref} autoPlay />\n        <div \n          tabIndex=\"0\"\n          hidden={!source}\n          className={'click-shield'}\n          ref={controllerRef}\n          onMouseEnter={()=>setFocused(true)}\n          onMouseLeave={()=>setFocused(false)}\n          onWheel={(e)=>onMouseWheel(e)}\n          onKeyDown={onKeyDown}\n          onKeyUp={onKeyUp}\n          onContextMenu={(e)=>onMouseDown(e, 3)}\n          onMouseDown={(e) => onMouseDown(e, 1)}\n          onMouseUp={(e) => onMouseUp(e, 1)}\n          onMouseMove={onMouseMove}\n        />\n        </>\n      </AspectRatio>\n      { !source && <div className={'waiting-component'}>{children}</div> }\n    </Container>\n  )\n}","export const opCodes = {\n  MOUSE_MOVE: 0x01,\n  MOUSE_BTN_DWN: 0x02,\n  MOUSE_BTN_UP: 0x03,\n  // MOUSE_BTN_DWN: 0x04,\n  MOUSE_BTN_CLK: 0x05,\n  KEY_DOWN: 0x06,\n  KEY_UP: 0x07,\n  REQUEST_CONTROL: 0x08,\n  RELEASE_CONTROL: 0x09,\n  ERROR: 0xFF\n}\n// TODO: not sure what the following code does yet....\nconst list = new Set()\nfor(const key in opCodes) {\n  list.add(opCodes[key]);\n}\nopCodes.list = list\n\n\nexport default class InstructionBuffer {\n  constructor(opCode, size) {\n    this.arrayBuffer = new ArrayBuffer(size+3);\n    this.header = new DataView(this.arrayBuffer, 0, 3);\n    this.payload = new DataView(this.arrayBuffer, 3);\n    this.pos = 0;\n    this.header.setUint8(0, opCode);\n    this.header.setUint16(1, this.payload.byteLength);\n  }\n\n  writeBigInt64(val, le) {\n    this.payload.setBigInt64(this.pos, val, le);\n    this.pos += 8;\n  }\n\n  writeBigUint64(val, le) {\n    this.payload.setBigUint64(this.pos, val, le);\n    this.pos += 8;\n  }\n\n  writeFloat64(val, le) {\n    this.payload.setFloat64(this.pos, val, le);\n    this.pos += 8;\n  }\n\n  writeFloat32(val, le) {\n    this.payload.setFloat32(this.pos, val, le);\n    this.pos += 4;\n  }\n\n  writeInt32(val, le) {\n    this.payload.setInt32(this.pos, val, le);\n    this.pos += 4;\n  }\n\n  writeInt16(val, le) {\n    this.payload.setInt16(this.pos, val, le);\n    this.pos += 2;\n  }\n\n  writeInt8(val, le) {\n    this.payload.setInt8(this.pos, val, le);\n    this.pos += 1;\n  }\n\n  writeUint32(val, le) {\n    this.payload.setUint32(this.pos, val, le);\n    this.pos += 4;\n  }\n\n  writeUint16(val, le) {\n    this.payload.setUint16(this.pos, val, le);\n    this.pos += 2;\n  }\n\n  writeUint8(val, le) {\n    this.payload.setUint8(this.pos, val, le);\n    this.pos += 1;\n  }\n}","import InstructionBuffer, { opCodes } from './InstructionBuffer'\n// import Keyboard from './keyboard'\nconst URLS = {\n  // TODO: Get this URL from a configuration file / environment variable\n  BASE : 'https://localhost',\n  VB_START : '/virtual_browser/start',\n  VB_STOP : '/virtual_browser/stop'\n}\n\n// TODO: Send updates from instruction buffer periodically(?)\nexport default class VirtualBrowserController {\n  constructor(client){\n    this.vbClient = client\n    // TODO: Not sure what the following is for yet\n    // this.keyboard = new Keyboard(input)\n  }\n\n  static async createInstance(){\n    // create the browser\n    const result = await fetch(URLS.BASE+URLS.VB_START)\n    console.log(result.status)\n    return result.status > 199 && result.status < 300\n  }\n\n  mouseUp(x, y, btn){\n    this.vbClient.send(JSON.stringify({\n      type : 'mouseUp',\n      args : [x, y, btn]\n    }))\n  }\n  /**\n   * \n   * @param {Number} x x-position of mouse\n   * @param {Number} y y-position of mouse\n   * @param {1|2|3|4|5|6|7|8|9} btn Left (1), middle (2), right (3), middle-up (4), middle-down (5) \\\n   * middle-left (6), middle-right (7), browser-back (8), browser-forward (0)\n   */\n  mouseDown(x, y, btn){\n    console.log('MouseDown', x, y, btn)\n    this.vbClient.send(JSON.stringify({\n      type : 'mouseDown',\n      args : [x, y, btn]\n    }))\n  }\n  mouseMove(x, y){\n    // if(!vidFocus) return false;\n    // const inst = new InstructionBuffer(opCodes.MOUSE_MOVE, 4);\n    // inst.writeUint16(x);\n    // inst.writeUint16(y);\n    this.vbClient.send(JSON.stringify({\n      type : 'mouseMove',\n      args : [x, y]\n    }))\n  }\n  keyDown(key){\n    // if(!vidFocus) return false;\n    // const inst = new InstructionBuffer(opCodes.KEY_DOWN, 2);\n    // inst.writeUint16(key);\n    this.vbClient.send(JSON.stringify({\n      type: 'keyDown',\n      args : [key],\n    }))\n  }\n\n  keyUp(key){\n    // if(!vidFocus) return false;\n    // const inst = new InstructionBuffer(opCodes.KEY_UP, 2);\n    // inst.writeUint16(key);\n    this.vbClient.send(JSON.stringify({\n      type: 'keyUp',\n      args : [key],\n    }))\n  }\n}","import React from 'react' \nimport styled from '@emotion/styled'\n\nconst Container = styled.div`\n  display : flex;\n  width : 100%;\n  height : 100%;\n  justify-content : center;\n  align-items : center;\n  > content {\n    width : 45%;\n    min-height : 300px;\n    background : rgba(255,255,255,0.3);\n    border-radius : 15px;\n    display : flex;\n    flex-direction : column;\n    padding ; 5px;\n  } \n  button {\n    padding : 10px 5px;\n    background : white;\n    border : 1px solid black;\n    outline : none;\n  }\n`\n\nexport default function WaitingElement(props){\n  const { \n    onRequestBrowser\n  } = props\n  return (\n    <Container>\n      <content>\n        <div>\n          Where do you want to go?\n          <input type={'text'}/>\n        </div>\n        <div>\n          <button onClick={onRequestBrowser}>Get Me A Browser</button>\n        </div>\n      </content>\n    </Container>\n  )\n}","import React, { useEffect, useRef, useState } from 'react'\nimport styled from '@emotion/styled'\nimport WRTCSessionManager from '../../lib/SocketController'\nimport VideoStream from '../../components/VideoStream'\nimport Icon from '../../icon-lib'\nimport VirtualBrowserController from '../../lib/BrowserController'\nimport WaitingElement from './WaitingElement'\n\n// TODO: Collapse to 20px or so when in collapsed mode\nconst ElementsContainer = styled.div`\n  flex : 0;\n  flex-basis : 100px;\n  color : white;\n  display : flex;\n  & button {\n    cursor : pointer;\n    background : transparent;\n    outline : none;\n    color : white;\n    border : none;\n    padding : 5px;\n    font-size : 24px;\n  }\n`\n\nconst RoomContainer = styled.div`\n  flex : 1;\n  height : 100%;\n  display : flex;\n  flex-direction : column;\n`\n\nexport default function(props){\n  const { \n    // todo: include room url\n    server = `wss://${window.location.hostname}`\n  } = props\n\n  const [streamSource, setStreamSource] = useState()\n  const [vbController, setVBController] = useState()\n  const ref = useRef()\n\n  useEffect(()=>{\n    const manager = new WRTCSessionManager({server})\n    manager.on('open', async () => {\n      // const browserId = await VirtualBrowserController.createInstance()\n    })\n    manager.on('peer.connect', (data)=>{\n      console.log(`Peer Connected: ${data}`)\n    })\n    \n    manager.on('browser.stream', (stream, peer)=>{\n      console.log('Stream Received', stream)\n      setStreamSource(stream)\n      // set the controller\n      setVBController(new VirtualBrowserController(peer))\n    })\n\n    return () => manager.destroy()\n  }, [server])\n\n  const toggleFullscreen = () => {\n    // eslint-disable-next-line\n    const prefixes = new Array('moz', 'ms', 'webkit')\n    if(!document.fullscreenEnabled || !prefixes.some(prefix=>document[`${prefix}FullscreenEnabled`])){\n      return false\n    }\n    return prefixes.some(prefix => {\n      if(typeof document[`${prefix}FullscreenElement`] === 'undefined') return false\n      if(!document[`${prefix}FullscreenElement`]) {\n        ref.current[`${prefix}RequestFullscreen`]()\n      }else{\n        document[`${prefix}ExitFullscreen`]()\n      }\n      return true\n    })\n  }\n\n  // Create a virtual browser in this room\n  const onRequestBrowser = async () => {\n    console.log('onRequestBrowser')\n    const browserId = await VirtualBrowserController.createInstance()\n    console.log(browserId)\n  }\n\n  return (\n    <RoomContainer ref={ref}>\n      <VideoStream source={streamSource} vbController={vbController}>\n        <WaitingElement onRequestBrowser={onRequestBrowser}/>\n      </VideoStream>\n      <ElementsContainer>\n        <button onClick={toggleFullscreen}>\n          <Icon icon='expand'/>\n        </button>\n      </ElementsContainer>\n    </RoomContainer>\n  )\n}","import styled from '@emotion/styled'\n\nexport default styled.div`\n  width  : 100%;\n  height : 100%;\n  overflow-x : ${({scrollX})=>{\n    if(!scrollX) return 'hidden'\n    if(scrollX === true) return 'scroll'\n    return scrollX\n  }};\n  overflow-y : ${({scrollY})=>{\n    if(!scrollY) return 'hidden'\n    if(scrollY === true) return 'scroll'\n    return scrollY\n  }};\n  overflow : ${({scroll})=>{\n    if(!scroll) return 'hidden'\n    if(scroll === true) return 'scroll'\n    return scroll\n  }};\n`","import React from 'react'\nimport { Global, css } from '@emotion/core'\n\nexport default function ResetCSS(){\n  return (\n    <Global styles={css`\n      html, body, #root {\n        width : 100%;\n        height : 100%;\n      }\n\n      /* http://meyerweb.com/eric/tools/css/reset/ \n        v2.0 | 20110126\n        License: none (public domain)\n      */\n\n      html, body, div, span, applet, object, iframe,\n      h1, h2, h3, h4, h5, h6, p, blockquote, pre,\n      a, abbr, acronym, address, big, cite, code,\n      del, dfn, em, img, ins, kbd, q, s, samp,\n      small, strike, strong, sub, sup, tt, var,\n      b, u, i, center,\n      dl, dt, dd, ol, ul, li,\n      fieldset, form, label, legend,\n      table, caption, tbody, tfoot, thead, tr, th, td,\n      article, aside, canvas, details, embed, \n      figure, figcaption, footer, header, hgroup, \n      menu, nav, output, ruby, section, summary,\n      time, mark, audio, video {\n        margin: 0;\n        padding: 0;\n        border: 0;\n        font-size: 100%;\n        font: inherit;\n        vertical-align: baseline;\n      }\n      /* HTML5 display-role reset for older browsers */\n      article, aside, details, figcaption, figure, \n      footer, header, hgroup, menu, nav, section {\n        display: block;\n      }\n      body {\n        line-height: 1;\n      }\n      ol, ul {\n        list-style: none;\n      }\n      blockquote, q {\n        quotes: none;\n      }\n      blockquote:before, blockquote:after,\n      q:before, q:after {\n        content: '';\n        content: none;\n      }\n      table {\n        border-collapse: collapse;\n        border-spacing: 0;\n      }\n    `} />\n  )\n}","export default {\n  dark : {\n    name : 'dark',\n    background : {\n      primary : '#1B1C26',\n      secondary : '#1B1C26'\n    },\n    darken : {\n      x1 : 'rgba(0,0,0,0.2)'\n    },\n    text : {\n      primary : 'white',\n      secondary : 'white'\n    },\n  },\n  light : {\n    name : 'light'\n  }\n}","import React from 'react' \nimport styled from '@emotion/styled'\n\nconst NavbarContainer = styled.div`\n  width : 100%;\n  height : 100%;\n  background : ${({theme}) => theme.darken.x1};\n  display : flex;\n  flex-direction : column;\n`\n\nexport default function Navbar(){\n  return (\n    <NavbarContainer>\n      <div>B</div>\n      <div></div>\n    </NavbarContainer>\n  )\n}","import React from 'react'\nimport { ThemeProvider } from 'emotion-theming'\nimport { BrowserRouter, Route } from 'react-router-dom'\nimport styled from '@emotion/styled'\n\nimport './icon-lib.js'\nimport RoomPage from './pages/Room'\nimport FullScreen from './components/layouts/FullScreen'\nimport ResetCSS from './ResetCSS'\nimport theme from './theme'\nimport Navbar from './components/Navbar'\n\nconst AppContainer = styled.div`\n  width : 100vw;\n  height : 100vh;\n  display : flex;\n  flex-direction : row;\n  background : ${({theme})=>theme.background.primary};\n`\n\nconst RouteContainer = styled.div`\n  flex : 1;\n  // order : 0;\n`\n\nconst NavbarContainer = styled.div`\n  min-width : 65px;\n  box-sizing : content-box;\n  order : 0;\n  background : ${({theme})=>theme.background.secondary};\n`\n// const webrtcSignalServer = 'wss://10.0.75.1:8443'\n\nfunction App() {\n  // TODO: use mobx to switch themes/preferences\n  return (\n    <ThemeProvider theme={theme.dark}>\n      <FullScreen>\n        <ResetCSS />\n        <BrowserRouter>\n          <AppContainer>\n            <NavbarContainer>\n              <Navbar />\n            </NavbarContainer>\n            <RouteContainer>\n              <Route path=\"/\" exact component={RoomPage} />\n            </RouteContainer>\n          </AppContainer>\n        </BrowserRouter>\n      </FullScreen>\n    </ThemeProvider>\n  )\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}